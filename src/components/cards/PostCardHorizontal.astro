---
import OptimizedPicture from '@/features/OptimizedPicture.astro';
import type { Lang } from '@/utils/i18n';
import { categoryLabel } from '@/utils/translations';
import { formatDate } from '@/utils/date';

interface Props {
  href?: string;
  imageSrc: any;
  imageAlt: string;
  title: string;
  description?: string;
  date?: string | Date;
  category?: string;
  lang?: Lang;

  priority?: boolean;
  class?: string;
}

const {
  href,
  imageSrc,
  imageAlt,
  title,
  description,
  date,
  category,
  lang = 'zh',
  priority = false,
  class: className,
} = Astro.props as Props;

const Container = href ? 'a' : 'div';
const containerAttrs = href ? { href } : {};
---

<Container
  {...containerAttrs}
  class={`group block rounded-xl overflow-hidden ${className ?? ''} transition-shadow duration-300`.trim()}
>
  <div class="relative aspect-[16/9] w-full overflow-hidden sm:hidden">
    <OptimizedPicture
      src={imageSrc}
      alt={imageAlt}
      class="absolute inset-0 h-full w-full object-cover transition-transform duration-300 ease-out will-change-transform group-hover:scale-[1.03]"
      fit="cover"
      position="center"
      priority={priority}
    />
    <div
      class="pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/80"
    >
    </div>
    <div class="absolute inset-x-0 bottom-0 p-4">
      <div class="flex items-center justify-between text-xs text-white/85">
        <span>{date ? formatDate(date, lang) : ''}</span>
        {category && <span class="ml-4 truncate">{categoryLabel(lang, category)}</span>}
      </div>
      <h3
        class="mt-4 text-base leading-snug font-bold text-white"
        style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;"
      >
        {title}
      </h3>
    </div>
  </div>

  <div class="hidden grid-cols-3 gap-0 sm:grid">
    <div class="relative col-span-2 aspect-[16/9] overflow-hidden">
      <OptimizedPicture
        src={imageSrc}
        alt={imageAlt}
        class="absolute inset-0 h-full w-full object-cover transition-transform duration-300 ease-out will-change-transform group-hover:scale-[1.03]"
        fit="cover"
        position="center"
        priority={priority}
      />
    </div>
    <div class="col-span-1 flex h-full flex-col p-4">
      <div class="flex items-center justify-between text-xs text-neutral-600 dark:text-neutral-300">
        <span>{date ? formatDate(date, lang) : ''}</span>
        {category && <span class="ml-4 truncate">{categoryLabel(lang, category)}</span>}
      </div>
      <h3
        class="mt-4 text-base leading-snug font-bold text-neutral-900 sm:text-lg dark:text-neutral-100"
        style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;"
      >
        {title}
      </h3>
      {
        description && (
          <p
            class="mt-4 text-sm leading-snug text-neutral-600 dark:text-neutral-300"
            style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;"
          >
            {description}
          </p>
        )
      }
      <div class="mt-auto"></div>
    </div>
  </div>
</Container>
